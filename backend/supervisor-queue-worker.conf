# Supervisor Configuration for Unity ERP Queue Workers
#
# This file should be placed in /etc/supervisor/conf.d/unity-erp-queue.conf
# After creating, run:
#   sudo supervisorctl reread
#   sudo supervisorctl update
#   sudo supervisorctl start unity-erp-queue-worker:*

[program:unity-erp-queue-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/unity-erp/backend/artisan queue:work database --sleep=3 --tries=3 --max-time=3600 --timeout=120
autostart=true
autorestart=true
stopasflimit=10
stopwaitsecs=3600
user=www-data
numprocs=4
redirect_stderr=true
stdout_logfile=/var/www/unity-erp/backend/storage/logs/queue-worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10

# Configuration Notes:
# - numprocs=4: Run 4 worker processes (adjust based on load)
# - max-time=3600: Restart worker every hour to prevent memory leaks
# - tries=3: Retry failed jobs up to 3 times
# - sleep=3: Sleep 3 seconds when no jobs available
# - timeout=120: Maximum 2 minutes per job
# - stopwaitsecs=3600: Wait up to 1 hour for graceful shutdown

# Priority Queues (Optional)
# [program:unity-erp-high-priority]
# process_name=%(program_name)s_%(process_num)02d
# command=php /var/www/unity-erp/backend/artisan queue:work database --queue=high,default --sleep=1 --tries=3
# autostart=true
# autorestart=true
# user=www-data
# numprocs=2
# redirect_stderr=true
# stdout_logfile=/var/www/unity-erp/backend/storage/logs/high-priority-worker.log
